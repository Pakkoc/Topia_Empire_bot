# <a:DH_MINA_09:1462814893546934418> Forge 화폐 설정

> ## <a:DH_MINA_04:1462813052138291282> 개요 및 목적
> ```- 활동형 화폐(토피)와 수익형 화폐(루비)의 이름 및 획득 규칙 설정
> - 텍스트/음성 활동 기반 보상 시스템 구성
> - 이체 수수료 및 월말 세금 등 경제 정책 설정```

---

> ## 1단계: 화폐 이름 설정
> ### <a:DH_MINA_03:1462813029577130200> 활동형 화폐
> * **topyName**: 채팅/음성 활동으로 획득하는 화폐 이름 (기본: 토피)
> <a:DH_MINA_03:1462813029577130200> 상점 구매, 게임 참가비 등에 사용

> ### <a:DH_MINA_03:1462813029577130200> 수익형 화폐
> * **rubyName**: 결제/장터 거래로 획득하는 유료 화폐 이름 (기본: 루비)
> <a:DH_MINA_03:1462813029577130200> 실제 결제 연동 또는 관리자 지급으로 획득

---

> ## 2단계: 화폐 관리자 설정
> ### <a:DH_MINA_03:1462813029577130200> 토피 관리자
> * **topyManagerEnabled**: 토피 관리자 기능 활성화 여부
> * 지정된 유저가 `/지급` 명령어로 토피를 무제한 지급 가능
> <a:DH_MINA_03:1462813029577130200> 유저 검색 후 추가/제거

> ### <a:DH_MINA_03:1462813029577130200> 루비 관리자
> * **rubyManagerEnabled**: 루비 관리자 기능 활성화 여부
> * 지정된 유저가 `/지급` 명령어로 루비를 무제한 지급 가능
> <a:DH_MINA_05:1462814742178693160> 유료 화폐이므로 신뢰할 수 있는 관리자만 지정

---

> ## 3단계: 텍스트 보상 설정
> ### <a:DH_MINA_03:1462813029577130200> 기본 설정
> * **textEarnEnabled**: 텍스트 보상 활성화 여부
> * **textEarnMin / textEarnMax**: 메시지당 지급 범위 (최소~최대)
> * **textMinLength**: 보상 받기 위한 최소 메시지 글자수
> <a:DH_MINA_03:1462813029577130200> 너무 짧은 메시지는 보상에서 제외

> ### <a:DH_MINA_03:1462813029577130200> 제한 설정
> * **textCooldownSeconds**: 보상 간 쿨다운 시간 (초)
> * **textMaxPerCooldown**: 쿨다운 기간 내 최대 보상 횟수
> * **textDailyLimit**: 하루에 텍스트로 획득 가능한 최대량
> ```기본값:
> - 쿨다운: 30초
> - 쿨다운당 횟수: 1회
> - 일일 제한: 300```

---

> ## 4단계: 음성 보상 설정
> ### <a:DH_MINA_03:1462813029577130200> 기본 설정
> * **voiceEarnEnabled**: 음성 보상 활성화 여부
> * **voiceEarnMin / voiceEarnMax**: 지급당 범위 (최소~최대)
> <a:DH_MINA_03:1462813029577130200> 음성 채널 참여 시 자동 지급

> ### <a:DH_MINA_03:1462813029577130200> 제한 설정
> * **voiceCooldownSeconds**: 지급 간격 (기본 60초)
> * **voiceDailyLimit**: 하루에 음성으로 획득 가능한 최대량
> ```기본값:
> - 쿨다운: 60초
> - 일일 제한: 2000```
> <a:DH_MINA_03:1462813029577130200> 음성 채널 유형별 배율은 화폐 규칙에서 설정

---

> ## 5단계: 이체 설정
> ### <a:DH_MINA_03:1462813029577130200> 토피 이체 규칙
> * **minTransferTopy**: 토피 이체 시 최소 금액 (기본: 100)
> * **transferFeeTopyPercent**: 토피 이체 수수료율 (기본: 1.2%)
> <a:DH_MINA_03:1462813029577130200> 수수료는 이체 금액에서 별도로 차감

> ### <a:DH_MINA_03:1462813029577130200> 루비 이체 규칙
> * **minTransferRuby**: 루비 이체 시 최소 금액 (기본: 1)
> * **transferFeeRubyPercent**: 루비 이체 수수료율 (기본: 0%)
> <a:DH_MINA_05:1462814742178693160> 유료 화폐이므로 수수료 설정에 주의

---

> ## 6단계: 월말 세금 설정
> ### <a:DH_MINA_03:1462813029577130200> 세금 규칙
> * **monthlyTaxEnabled**: 월말 세금 활성화 여부
> * **monthlyTaxPercent**: 세금률 (기본: 3.3%)
> <a:DH_MINA_03:1462813029577130200> 매월 마지막 날 23시에 토피 잔액에서 자동 차감
> ```주의:
> - 금고 잔액은 세금 계산에서 제외됨
> - 세금 이력은 거래 기록에서 확인 가능```

---

> ## 7단계: 거래 알림 채널
> ### <a:DH_MINA_03:1462813029577130200> 알림 채널 설정
> * **currencyLogChannelId**: 거래 알림을 받을 채널
> <a:DH_MINA_03:1462813029577130200> 미설정 시 명령어 실행 채널에 결과 표시
> ```기록 대상:
> - /이체 (송금) 내역
> - 관리자 /지급 및 /차감 내역
> - 월말 세금 처리 결과```

---

> ## 8단계: 아이템 관리자 설정
> ### <a:DH_MINA_03:1462813029577130200> 관리자 역할 지정
> * **itemManagerRoleId**: 아이템 지급/회수 권한을 가진 역할
> <a:DH_MINA_03:1462813029577130200> 미설정 시 서버 관리자만 사용 가능

> ### <a:DH_MINA_03:1462813029577130200> 로그 채널 지정
> * **itemLogChannelId**: 아이템 지급/회수 로그가 기록되는 채널
> <a:DH_MINA_03:1462813029577130200> 미설정 시 명령어 실행 채널에 결과 표시

> ### <a:DH_MINA_03:1462813029577130200> `/아이템지급` 명령어
> * 특정 유저에게 상점 아이템 직접 지급
> * 옵션: 유저, 아이템(자동완성), 수량(1-999), 사유(선택)
> * 권한: 아이템 관리자 역할 또는 서버 관리자
> ```처리 흐름:
> 1. 아이템 목록 자동완성으로 검색
> 2. 지급 처리 → 인벤토리에 추가
> 3. 로그 채널에 기록
> 4. 대상에게 DM 알림 전송```

> ### <a:DH_MINA_03:1462813029577130200> `/아이템회수` 명령어
> * 특정 유저의 아이템 회수
> * 옵션: 유저, 아이템(자동완성), 수량(1-999), 사유(선택)
> * 권한: 아이템 관리자 역할 또는 서버 관리자
> ```처리 흐름:
> 1. 유저 보유 아이템만 자동완성으로 표시
> 2. 회수 처리 → 수량 차감
> 3. 연관 역할 자동 제거 (역할선택권)
> 4. 로그 채널에 기록
> 5. 대상에게 DM 알림 전송```
> <a:DH_MINA_03:1462813029577130200> 역할선택권 아이템 회수 시 부여된 역할도 함께 제거됨

---

> ## 9단계: 봇 명령어
> ### <a:DH_MINA_03:1462813029577130200> 일반 유저 명령어
> * **`/이체`**: 다른 유저에게 화폐 송금
>   - 옵션: 받는사람, 금액, 화폐, 사유(선택)
>   - 이체수수료감면권 보유 시 감면권 선택 UI 표시
>   - 금고 등급 구독자는 이체수수료 자동 면제
>   - 거래 완료 시 송/수신자 모두 DM 알림
> * **`/출석`**: 일일 출석 체크로 보상 획득
>   - 하루 1회만 사용 가능 (자정 기준 리셋)
>   - 연속 출석일수 및 총 출석일수 표시
>   - 출석 보상으로 토피 자동 지급
> * **`/내정보`**: 개인 프로필 카드 조회
>   - 현재 레벨, XP (막대 게이지 표시)
>   - 보유 토피/루비 잔액 표시
>   - 서버 내 XP 순위 표시
>   - 프로필 카드 이미지로 렌더링

> ### <a:DH_MINA_03:1462813029577130200> 관리자 명령어
> * **`/지급`**: 유저에게 화폐 지급 (화폐 관리자 전용)
>   - 옵션: 유저, 금액, 화폐, 사유(선택)
> * **`/차감`**: 유저의 화폐 차감 (화폐 관리자 전용)
>   - 옵션: 유저, 금액, 화폐, 사유(선택)
> <a:DH_MINA_03:1462813029577130200> 모든 관리자 조작은 로그 채널에 기록됨

---

> ## 10단계: 봇 동작 (자동 처리)
> ### <a:DH_MINA_03:1462813029577130200> 텍스트 보상 처리
> * 유저가 메시지 전송 시 자동으로 토피 계산
> * 최소 글자수, 쿨다운, 차단 규칙 적용 후 지급
> * 일일 제한에 도달하면 다음 날까지 지급 중단
> ```처리 흐름:
> 1. 메시지 감지 → 글자수 확인
> 2. 차단 규칙 확인 → 쿨다운 확인
> 3. 일일 제한 확인 → 토피 범위 내 랜덤 지급
> 4. 거래 기록 저장```

> ### <a:DH_MINA_03:1462813029577130200> 음성 보상 처리
> * 음성 채널 참여 중 주기적으로 토피 지급
> * 쿨다운 간격마다 자동 계산
> * 혼자 있는 채널에서는 토피 미지급
> ```처리 흐름:
> 1. 음성 채널 참여 감지
> 2. 쿨다운 주기마다 지급 시도
> 3. 일일 제한 확인 → 토피 지급
> 4. 거래 기록 저장```

> ### <a:DH_MINA_03:1462813029577130200> 월말 세금 스케줄러
> * **실행 시점**: 매월 마지막 날 23시 (1시간 단위 체크)
> * **처리 대상**: 지갑 잔액이 있는 모든 유저
> * **세금 계산**: (지갑 잔액 × 세금률%) - 금고 잔액 제외
> * **감면 처리**: 세금감면권 보유 시 감면 적용
> ```처리 흐름:
> 1. 월말 23시 체크
> 2. 모든 유저 지갑 잔액 조회
> 3. 세금감면권 적용 확인
> 4. 세금 차감 → 국고 적립
> 5. 개인 DM 알림 전송 (차감/면제/부분감면)
> 6. 로그 채널에 처리 결과 전송```

---

> ## 11단계: 지갑 관리 (웹 대시보드)
> ### <a:DH_MINA_03:1462813029577130200> 지갑 조회
> * 유저별 토피/루비 잔액 조회
> * 유저 ID로 검색 가능
> * 페이지네이션 지원 (20명 단위)
> <a:DH_MINA_03:1462813029577130200> 지급/차감은 /지급, /차감 명령어로만 가능

> ### <a:DH_MINA_03:1462813029577130200> 토피 랭킹 TOP 5
> * 토피 보유량 상위 5명 표시
> * 순위, 아바타, 닉네임, 잔액 표시
> <a:DH_MINA_03:1462813029577130200> 실시간 랭킹 갱신

---

> ## 12단계: 거래 내역 (웹 대시보드)
> ### <a:DH_MINA_03:1462813029577130200> 거래 내역 조회
> * 서버 전체 거래 내역 조회
> * 유저 ID로 필터링 가능
> * 화폐 타입 필터 (토피/루비/전체)
> * 거래 유형 필터 지원
> * 날짜별 필터링 가능
> <a:DH_MINA_03:1462813029577130200> 페이지네이션 지원

> ### <a:DH_MINA_03:1462813029577130200> 거래 유형
> ```거래 타입:
> - 채팅 보상, 음성 보상, 출석 보상
> - 송금 받음, 송금 보냄
> - 상점 구매, 장터 구매/판매
> - 세금, 수수료
> - 관리자 추가/차감
> - 내전 참가비, 내전 보상, 게임 환불```

---

> ## <a:DH_MINA_05:1462814742178693160> 주의사항 및 제약
> ### 1. 화폐 비활성화
> <a:DH_MINA_03:1462813029577130200> 화폐를 비활성화하면 해당 화폐의 모든 기능 사용 불가
> ### 2. 관리자 권한
> <a:DH_MINA_03:1462813029577130200> 화폐 관리자는 무제한 지급 가능하므로 신중하게 지정
> ### 3. 일일 제한
> <a:DH_MINA_03:1462813029577130200> 일일 제한에 도달하면 다음 날까지 보상 불가
> ### 4. 봇에게 이체 불가
> <a:DH_MINA_03:1462813029577130200> /이체, /지급 명령어는 봇에게 사용 불가

---

> ### <a:DH_MINA_13:1462814948127146005> 요약
> - 1. **화폐 이름**: 토피/루비 이름 커스터마이징
> - 2. **화폐 관리자**: 각 화폐별 지급 권한 관리자 지정
> - 3. **텍스트 보상**: 채팅 메시지 기반 토피 지급 규칙
> - 4. **음성 보상**: 음성 채널 활동 기반 토피 지급 규칙
> - 5. **이체 설정**: 최소 금액 및 수수료율 설정
> - 6. **월말 세금**: 자동 차감되는 보유세 설정 (스케줄러)
> - 7. **알림 채널**: 거래 및 아이템 로그 채널 설정
> - 8. **봇 명령어**: /이체, /지급, /차감, /출석, /내정보 명령어 지원
> - 9. **아이템 관리**: /아이템지급, /아이템회수 (역할 자동 제거 포함)
> - 10. **DM 알림**: 이체, 세금, 아이템 지급/회수 시 개인 DM 발송
> - 11. **출석 체크**: 일일 출석으로 연속/총 출석일수 기록 및 보상 지급
> - 12. **지갑 관리**: 유저별 잔액 조회, 토피 랭킹 (웹 대시보드)
> - 13. **거래 내역**: 필터/검색 지원 거래 기록 조회 (웹 대시보드)
