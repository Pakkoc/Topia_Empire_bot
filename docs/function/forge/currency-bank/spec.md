# <a:sd:1462495939058208960> Forge 국고(Bank) 시스템 <a:sd:1462495961178701834>

> ## <a:DH_MINA_04:1462813052138291282> 개요 및 목적
> ```- 서버에서 발생한 수수료와 세금을 자동 적립하는 국고 시스템
> - 국고 관리자가 화폐를 유저에게 지급할 수 있는 기능
> - 디스코드 채널에 디토뱅크 패널을 설치하여 금융 서비스 제공```

---

> ## 1단계: 국고 현황 모니터링
> ### <a:DH_MINA_03:1462813029577130200> 현재 잔액
> * **토피 잔액 (topyBalance)**: 국고에 적립된 활동형 화폐
> * **루비 잔액 (rubyBalance)**: 국고에 적립된 수익형 화폐
> <a:DH_MINA_03:1462813029577130200> 웹 대시보드에서 실시간 확인 가능

> ### <a:DH_MINA_03:1462813029577130200> 이번 달 수집량
> ```- 토피 수집량: 이번 달 적립된 토피
> - 루비 수집량: 이번 달 적립된 루비```

> ### <a:DH_MINA_03:1462813029577130200> 누적 통계
> * **총 토피 수집**: 서버 개설 이후 총 적립된 토피
> * **총 루비 수집**: 서버 개설 이후 총 적립된 루비
> * **총 토피 지급**: 국고에서 지급된 총 토피
> * **총 루비 지급**: 국고에서 지급된 총 루비

---

> ## 2단계: 국고 수집 항목
> ### <a:DH_MINA_03:1462813029577130200> 자동 적립 항목
> * **이체 수수료 (transfer_fee)**: 유저 간 화폐 이체 시 발생하는 수수료
> * **상점 수수료 (shop_fee)**: 상점에서 아이템 구매 시 발생하는 수수료
> * **월말 세금 (tax)**: 매월 말일에 부과되는 보유세
> <a:DH_MINA_03:1462813029577130200> 수수료율과 세금은 화폐 설정에서 변경 가능

> ### <a:DH_MINA_03:1462813029577130200> 관리자 지급 내역
> * **admin_distribute**: 국고 관리자가 유저에게 지급한 기록
> <a:DH_MINA_03:1462813029577130200> 모든 국고 거래는 내역으로 기록됨

---

> ## 3단계: 은행 이름 설정
> ### <a:DH_MINA_03:1462813029577130200> 커스텀 은행명
> * **bankName**: 서버에서 사용할 은행 이름 (기본: 디토뱅크)
> * **최대 20자** 제한
> <a:DH_MINA_03:1462813029577130200> 패널과 명령어 응답에 설정된 은행명이 표시됨

---

> ## 4단계: 국고 관리자 설정
> ### <a:DH_MINA_03:1462813029577130200> 역할로 지정
> * **treasuryManagerRoleId**: 국고 관리 권한을 부여할 역할
> <a:DH_MINA_03:1462813029577130200> 해당 역할을 가진 멤버는 /국고 명령어 사용 가능

> ### <a:DH_MINA_03:1462813029577130200> 유저 직접 지정
> * **treasuryManagerUserIds**: 개별 유저에게 직접 권한 부여
> <a:DH_MINA_03:1462813029577130200> 역할과 별개로 특정 유저에게 권한 부여 가능

> ### <a:DH_MINA_05:1462814742178693160> 중요
> ```"서버 관리자라도 별도로 지정되어야 /국고 명령어 사용 가능"```
> <a:DH_MINA_03:1462813029577130200> 역할 또는 유저 중 하나 이상 설정 필요

---

> ## 5단계: 디토뱅크 패널 설치
> ### <a:DH_MINA_03:1462813029577130200> 패널 설치 과정
> 1. **채널 선택**: 패널을 설치할 텍스트 채널 지정
> 2. **설치 버튼 클릭**: 선택한 채널에 패널 메시지 생성
> 3. **교체**: 다른 채널 선택 시 기존 패널 삭제 후 재생성
> <a:DH_MINA_03:1462813029577130200> 패널 삭제 시 해당 채널의 메시지도 제거

> ### <a:DH_MINA_03:1462813029577130200> 패널 기능
> ```- 내 정보: 구독 상태, 금고 잔액, 혜택 확인
> - 예금/출금: 금고에 안전하게 화폐 보관
> - 거래 내역: 개인 거래 기록 확인
> - 국고 현황: 서버 국고 잔액 실시간 표시```

---

> ## 6단계: 금고 명령어 (일반 유저)
> ### <a:DH_MINA_03:1462813029577130200> `/금고` 서브커맨드
> * **`/금고 확인`**: 금고 잔액 및 구독 상태 확인
>   - 구독 등급명, 만료일 표시
>   - 금고 잔액, 한도 표시
>   - 예상 이자 표시
> * **`/금고 예금`**: 지갑에서 금고로 토피 입금
>   - 옵션: 금액
>   - 금고 한도 확인 후 처리
> * **`/금고 출금`**: 금고에서 지갑으로 토피 출금
>   - 옵션: 금액
>   - 금고 잔액 확인 후 처리
> <a:DH_MINA_03:1462813029577130200> 금고 등급 미구독 시 예금/출금 불가

---

> ## 7단계: 국고 관리 명령어
> ### <a:DH_MINA_03:1462813029577130200> 명령어 목록
> * **`/국고 조회`**: 현재 국고 잔액(토피, 루비) 확인
> * **`/국고 지급`**: 국고에서 특정 유저에게 화폐 지급
>   - 옵션: 유저, 금액, 화폐, 사유(선택)
> * **`/국고 대량지급`**: 특정 역할의 모든 유저에게 화폐 지급
>   - 옵션: 역할, 1인당 금액, 화폐, 사유(선택)
> * **`/국고 내역`**: 국고 입출금 거래 내역 확인
> <a:DH_MINA_03:1462813029577130200> 모든 명령어는 국고 관리자만 사용 가능

---

> ## 8단계: 봇 디토뱅크 패널 동작
> ### <a:DH_MINA_03:1462813029577130200> 패널 UI 구성
> ```- 국고 현황: 토피/루비 잔액 표시
> - 구독 혜택 안내: 금고 등급별 혜택 목록
> - 버튼: 내 정보, 예금, 출금, 내역```

> ### <a:DH_MINA_03:1462813029577130200> 내 정보 버튼
> * 구독 상태 (등급명, 만료일) 표시
> * 적용 중인 혜택 목록 (이체수수료 면제, 이자율 등)
> * 금고 잔액 및 예상 이자 표시
> <a:DH_MINA_03:1462813029577130200> 5분 후 자동 삭제되는 ephemeral 메시지

> ### <a:DH_MINA_03:1462813029577130200> 예금 버튼
> ```처리 흐름:
> 1. 구독 여부 확인 (미구독 시 오류)
> 2. 예금 금액 입력 모달 표시
> 3. 금고 한도 확인 → 지갑에서 차감
> 4. 금고에 입금 → 결과 표시```

> ### <a:DH_MINA_03:1462813029577130200> 출금 버튼
> ```처리 흐름:
> 1. 금고 잔액 확인 (잔액 없으면 오류)
> 2. 출금 금액 입력 모달 표시
> 3. 금고에서 차감 → 지갑에 입금
> 4. 결과 표시```

> ### <a:DH_MINA_03:1462813029577130200> 내역 버튼
> * 최근 10건의 개인 거래 내역 표시
> * 거래 유형별 이모지 및 라벨 표시
> ```거래 타입:
> - ➕ 지급, ➖ 차감
> - 📥 받음, 📤 보냄
> - 🛒 구매, 💸 수수료
> - 🏛️ 세금, 🏦 예금/출금
> - 📅 출석, 💬 채팅, 🎤 음성```

---

> ## 9단계: 금고 이자 스케줄러
> ### <a:DH_MINA_03:1462813029577130200> 이자 지급 시점
> * **실행 시점**: 매월 1일 0시 (1시간 단위 체크)
> * **지급 대상**: 금고에 예치금이 있는 구독자
> * **이자 계산**: 금고 잔액 × 월 이자율(%)
> <a:DH_MINA_03:1462813029577130200> 이자는 지갑으로 직접 지급됨

> ### <a:DH_MINA_03:1462813029577130200> 이자 지급 프로세스
> ```처리 흐름:
> 1. 매월 1일 0시 체크
> 2. 모든 금고 예치금 조회
> 3. 구독 등급별 이자율 적용
> 4. 이자 계산 → 지갑에 지급
> 5. 개인 DM 알림 전송
> 6. 로그 채널에 처리 결과 전송```

> ### <a:DH_MINA_03:1462813029577130200> DM 알림 내용
> ```- 서버명 및 처리 월
> - 금고 잔액
> - 적용 이자율 (%)
> - 이자 지급액
> - "이자는 지갑으로 직접 지급되었습니다"```

---

> ## 10단계: 국고 자동 갱신
> ### <a:DH_MINA_03:1462813029577130200> 패널 자동 갱신
> * 수수료/세금 발생 시 국고 잔액 자동 업데이트
> * 디토뱅크 패널의 국고 현황 실시간 갱신
> <a:DH_MINA_03:1462813029577130200> 이체/상점 구매/세금 처리 시 자동 갱신

---

> ## <a:DH_MINA_05:1462814742178693160> 주의사항 및 제약
> ### 1. 관리자 지정 필수
> <a:DH_MINA_03:1462813029577130200> 역할 또는 유저가 지정되지 않으면 아무도 /국고 명령어 사용 불가
> ### 2. 국고 잔액 부족
> <a:DH_MINA_03:1462813029577130200> 잔액보다 많은 금액 지급 시 오류 발생
> ### 3. 월말 세금 계산
> <a:DH_MINA_03:1462813029577130200> 금고 잔액은 세금 계산에서 제외됨
> ### 4. 구독 만료
> <a:DH_MINA_03:1462813029577130200> 구독 만료 시 금고 접근 불가 (예치금은 유지됨)

---

> ### <a:DH_MINA_13:1462814948127146005> 요약
> - 1. **자동 적립**: 이체 수수료, 상점 수수료, 월말 세금이 국고에 자동 적립
> - 2. **실시간 현황**: 웹 대시보드에서 잔액 및 통계 확인
> - 3. **관리자 설정**: 역할 또는 유저 단위로 국고 관리 권한 부여
> - 4. **디토뱅크 패널**: 멤버들이 금융 서비스를 이용할 수 있는 UI 제공
> - 5. **금고 명령어**: /금고 확인|예금|출금 서브커맨드 지원
> - 6. **국고 관리 명령어**: 조회, 지급, 대량지급, 내역 확인 기능
> - 7. **예금/출금**: 금고에 토피 안전하게 보관 (세금 면제)
> - 8. **월 이자 스케줄러**: 매월 1일 금고 잔액에 이자 자동 지급
> - 9. **DM 알림**: 이자 지급 시 개인 DM 발송
